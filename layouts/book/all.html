{{ define "main" }}
<div id="layout">
<article>

{{- partial "content.header.html" . -}}

<!-- https://discourse.gohugo.io/t/how-to-build-one-collection-for-all-nested-sections/27950/5 -->
{{- with .Content -}}
<section>
{{ . }}
</section>
{{- end -}}

<section class="list-page">
<!-- preambles -->

<ul>
{{ range .Pages.ByTitle }}
{{ if .IsPage }}
<li><a href="{{ .RelPermalink }}">{{ .Title }}{{- if .Draft -}} :: Draft {{- end -}}</a></li>
{{ end }}
{{ end }}
</ul>

<!-- sub categories & pages -->

{{ $indexScratch := .Scratch }}
{{ range .Sections }}
{{ $indexScratch.Add "sections" (slice . ) }}
{{ end }}

{{- range ($indexScratch.Get "sections").ByTitle -}}
<p><a href="{{ .RelPermalink }}">{{ .Title }}{{- if .Draft -}} :: Draft {{- end -}}</a></p>
<ul>
  {{- range .Pages.ByTitle -}}
  <li><a href="{{ .RelPermalink }}">{{ .Title }}{{- if .Draft -}} :: Draft {{- end -}}</a></li>
  {{- end -}}
</ul>
{{- end -}}
</section>

{{ partial "footer.html" . }}
{{ partial "nav.html" . }}

</article>
</div>
{{ end }}
